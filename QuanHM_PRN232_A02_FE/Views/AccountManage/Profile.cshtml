@{
    ViewData["Title"] = "My Profile";
}
<h2>My Profile</h2>
<form id="frm">
    <div class="mb-3">
        <label>Email</label>
        <input id="email" class="form-control" disabled />
    </div>
    <div class="mb-3">
        <label>Full Name</label>
        <input id="fullname" class="form-control" />
    </div>
    <div class="mb-3">
        <label>New Password</label>
        <input id="password" type="password" class="form-control" />
    </div>
    <button class="btn btn-primary">Save</button>
</form>

@section Scripts {
    <script>
        const u = currentUser();
        if (!u) { alert("Login required"); location.href="/Account/Login"; }

        function load(){
          apiGet(`accounts/${u.email}`, function(a){
            $("#email").val(a.email);
            $("#fullname").val(a.fullName);
          });
        }
        $("#frm").on("submit", function(e){
          e.preventDefault();
          const dto = {
            email: $("#email").val(),
            fullName: $("#fullname").val(),
            password: $("#password").val()
          };
          apiPut(`accounts/profile`, dto, function(){
            alert("Profile updated. Please re-login.");
            clearToken();
            location.href="/Account/Login";
          });
        });
        $(load);
    </script>
}
