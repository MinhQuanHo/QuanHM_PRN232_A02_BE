@{
    ViewData["Title"] = "Edit News";
    var id = (string)ViewBag.Id;
}
<h2>Edit @id</h2>
<form id="frm">
    <input type="hidden" id="id" value="@id" />
    <div class="mb-3">
        <label class="form-label">Title</label>
        <input id="title" class="form-control" />
    </div>
    <div class="mb-3">
        <label class="form-label">Headline</label>
        <input id="headline" class="form-control" />
    </div>
    <div class="mb-3">
        <label class="form-label">Content</label>
        <textarea id="content" class="form-control" rows="5"></textarea>
    </div>
    <div class="mb-3">
        <label class="form-label">Source</label>
        <input id="source" class="form-control" />
    </div>
    <div class="mb-3">
        <label class="form-label">CategoryId</label>
        <input id="cat" type="number" class="form-control" />
    </div>
    <div class="mb-3">
        <label class="form-label">Status</label>
        <select id="status" class="form-select">
            <option value="true">Published</option>
            <option value="false">Draft/Hidden</option>
        </select>
    </div>
    <button class="btn btn-primary" type="submit">Save</button>
    <a class="btn btn-secondary ms-2" href="/News/Manage">Back</a>
</form>

@section Scripts {
    <script>
        const id = $("#id").val();
        function load(){
          apiGet(`news/${id}`, function(n){
            $("#title").val(n.newsTitle || "");
            $("#headline").val(n.headline || "");
            $("#content").val(n.newsContent || "");
            $("#source").val(n.newsSource || "");
            $("#cat").val(n.categoryId || "");
            $("#status").val((n.newsStatus === true) ? "true" : "false");
          });
        }
        $("#frm").on("submit", function(e){
          e.preventDefault();
          const dto = {
            newsArticleId: id,
            newsTitle: $("#title").val(),
            headline: $("#headline").val(),
            newsContent: $("#content").val(),
            newsSource: $("#source").val(),
            categoryId: $("#cat").val() ? parseInt($("#cat").val()) : null,
            newsStatus: $("#status").val() === "true"
          };
          apiPut(`news/${id}`, dto, function(){
            alert("Saved"); location.href="/News/Manage";
          });
        });
        $(load);
    </script>
}
